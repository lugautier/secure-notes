#!/bin/bash

# Pre-commit hook: Format code and run build before allowing commit
# This ensures all commits have correct formatting
# Installed automatically by maven-git-hooks-plugin

echo "üîç Running Spotless formatter and build..."

# Run Maven build with Spotless auto-format
./mvnw clean compile -DskipTests

BUILD_EXIT_CODE=$?

git add --update

if [ $BUILD_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå BUILD FAILED"
    echo ""
    echo "‚ÑπÔ∏è  Spotless has auto-formatted your code"
    echo "‚ÑπÔ∏è  Formatted files are staged"
    echo ""
    exit 1
fi

echo ""
echo "‚úÖ BUILD PASSED"
echo "‚úÖ Code is properly formatted"
echo "‚úÖ Formatted files updated in staging area"
echo "‚úÖ Proceeding with commit..."
echo ""

exit 0
